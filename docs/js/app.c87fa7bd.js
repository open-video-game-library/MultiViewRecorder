(function(e){function t(t){for(var i,o,r=t[0],s=t[1],d=t[2],l=0,m=[];l<r.length;l++)o=r[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);u&&u(t);while(m.length)m.shift()();return c.push.apply(c,d||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],i=!0,r=1;r<n.length;r++){var s=n[r];0!==a[s]&&(i=!1)}i&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={app:0},c=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],s=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var u=s;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1437:function(e,t,n){},3629:function(e,t,n){"use strict";n("1437")},"3bc4":function(e,t,n){},"4b4f":function(e,t,n){"use strict";n("ecb8")},5411:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("7a23"),a=function(e){return Object(i["m"])("data-v-00a216dd"),e=e(),Object(i["l"])(),e},c={class:"wrapper"},o={class:"container"},r=a((function(){return Object(i["f"])("h1",null,"Multi View Recorder",-1)})),s={class:"btns"},d={class:"wrapper"},u={class:"container"},l=Object(i["g"])(" Presented by Open Video Game Library "),m=a((function(){return Object(i["f"])("a",{href:"https://keita-lab.jp/",target:"_blank",rel:"noopener noreferrer"},"WATANABE LABORATORY",-1)})),f=Object(i["g"])(", Meiji Univ. ");function h(e,t,n,a,h,p){var v=Object(i["o"])("fa"),b=Object(i["o"])("Settings"),g=Object(i["o"])("Information"),O=Object(i["o"])("Recorder");return Object(i["k"])(),Object(i["e"])("div",null,[Object(i["f"])("header",c,[Object(i["f"])("div",o,[r,Object(i["f"])("div",s,[Object(i["f"])("p",{class:"btn-icon",onClick:t[0]||(t[0]=function(){return p.openInformation&&p.openInformation.apply(p,arguments)})},[Object(i["h"])(v,{icon:"question-circle"})]),Object(i["f"])("p",{class:"btn-icon",onClick:t[1]||(t[1]=function(){return p.openSettings&&p.openSettings.apply(p,arguments)})},[Object(i["h"])(v,{icon:"cog"})])])])]),Object(i["h"])(i["b"],{name:"fade"},{default:Object(i["u"])((function(){return[Object(i["v"])(Object(i["h"])(b,{onCloseSettings:p.closeSettings,onChangeCanvasSize:p.setCanvasSize,onChangeFrameRate:p.setFrameRate,onChangeMimetype:p.setMimetype,canvasHeight:h.canvasHeight,frameRate:h.frameRate,mimetype:h.mimetype},null,8,["onCloseSettings","onChangeCanvasSize","onChangeFrameRate","onChangeMimetype","canvasHeight","frameRate","mimetype"]),[[i["s"],h.showSettings]])]})),_:1}),Object(i["h"])(i["b"],{name:"fade"},{default:Object(i["u"])((function(){return[Object(i["v"])(Object(i["h"])(g,{onCloseInformation:p.closeInformation},null,8,["onCloseInformation"]),[[i["s"],h.showInformation]])]})),_:1}),Object(i["f"])("main",d,[Object(i["f"])("div",u,[Object(i["h"])(O,{id:"recorder",canvasHeight:h.canvasHeight,frameRate:h.frameRate,mimetype:h.mimetype},null,8,["canvasHeight","frameRate","mimetype"])])]),Object(i["f"])("footer",null,[l,Object(i["h"])(v,{icon:"copyright"}),Object(i["g"])(" "+Object(i["p"])(h.year)+" ",1),m,f])])}var p={class:"wrapper"},v={class:"movie-wrapper"},b=["width","height"],g={class:"recording-info-wrapper"};function O(e,t,n,a,c,o){var r=Object(i["o"])("CameraSelect"),s=Object(i["o"])("MicSelect");return Object(i["k"])(),Object(i["e"])("div",p,[Object(i["f"])("div",v,[Object(i["h"])(r,{disabled:c.isRecording,onChangeCamera:t[0]||(t[0]=function(e){return o.changeCamera(0,e)})},null,8,["disabled"]),Object(i["h"])(r,{disabled:c.isRecording,onChangeCamera:t[1]||(t[1]=function(e){return o.changeCamera(1,e)})},null,8,["disabled"]),Object(i["f"])("canvas",{ref:"canvas",width:c.canvasWidth,height:n.canvasHeight},"Canvas not available.",8,b),Object(i["h"])(r,{disabled:c.isRecording,onChangeCamera:t[2]||(t[2]=function(e){return o.changeCamera(2,e)})},null,8,["disabled"]),Object(i["h"])(r,{disabled:c.isRecording,onChangeCamera:t[3]||(t[3]=function(e){return o.changeCamera(3,e)})},null,8,["disabled"])]),Object(i["f"])("section",null,[Object(i["h"])(s,{disabled:c.isRecording,onChangeMic:o.changeMic},null,8,["disabled","onChangeMic"])]),Object(i["f"])("section",g,[Object(i["f"])("button",{onClick:t[4]||(t[4]=function(){return o.clickRecordingBtn&&o.clickRecordingBtn.apply(o,arguments)})},Object(i["p"])(c.record_text),1),Object(i["f"])("p",null,"Status : "+Object(i["p"])(c.record_status),1),Object(i["f"])("p",null,"Time : "+Object(i["p"])(c.record_time),1)])])}n("a9e3"),n("d81d"),n("d3b7"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("ac1f"),n("466d"),n("fb6a"),n("b0c0");var j=["value"];function _(e,t,n,a,c,o){return Object(i["v"])((Object(i["k"])(),Object(i["e"])("select",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.changeCamera=e})},[(Object(i["k"])(!0),Object(i["e"])(i["a"],null,Object(i["n"])(c.camera_options,(function(e){return Object(i["k"])(),Object(i["e"])("option",{value:e.value,key:e.value},Object(i["p"])(e.name),9,j)})),128))],512)),[[i["r"],o.changeCamera]])}var y=n("1da1"),w=(n("96cf"),{name:"CameraSelect",components:{},mounted:function(){var e=this;Object(y["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:return t.next=4,navigator.mediaDevices.enumerateDevices();case 4:n=t.sent,n.map((function(t){"videoinput"===t.kind&&e.camera_options.push({name:t.label,value:t.deviceId})}));case 6:case"end":return t.stop()}}),t)})))().then((function(){e.camera_options[0].name="Select a camera."}))},computed:{changeCamera:{get:function(){return this.camera_options[0].value},set:function(e){this.$emit("change-camera",e)}}},methods:{},data:function(){return{camera_options:[{value:"none",name:"Loading..."},{value:"audioWaveform",name:"Audio waveform"}]}}}),R=n("6b0d"),S=n.n(R);const k=S()(w,[["render",_]]);var C=k,I=["value"];function M(e,t,n,a,c,o){return Object(i["v"])((Object(i["k"])(),Object(i["e"])("select",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.changeMic=e})},[(Object(i["k"])(!0),Object(i["e"])(i["a"],null,Object(i["n"])(c.mic_options,(function(e){return Object(i["k"])(),Object(i["e"])("option",{value:e.value,key:e.value},Object(i["p"])(e.name),9,I)})),128))],512)),[[i["r"],o.changeMic]])}var H={name:"MicSelect",components:{},mounted:function(){var e=this;Object(y["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:return t.next=4,navigator.mediaDevices.enumerateDevices();case 4:n=t.sent,n.map((function(t){"audioinput"===t.kind&&e.mic_options.push({name:t.label,value:t.deviceId})}));case 6:case"end":return t.stop()}}),t)})))().then((function(){e.mic_options[0].name="Select a microphone."}))},computed:{changeMic:{get:function(){return this.mic_options[0].value},set:function(e){this.$emit("change-mic",e)}}},methods:{},data:function(){return{mic_options:[{value:"none",name:"Loading..."}]}}};const x=S()(H,[["render",M]]);var W=x,T={name:"Recorder",components:{CameraSelect:C,MicSelect:W},props:{canvasHeight:Number,frameRate:Number,mimetype:String},mounted:function(){var e=this;this.video.map((function(t,n){e.video[n].element=document.createElement("video")})),this.canvas=this.$refs.canvas,this.context=this.canvas.getContext("2d")},methods:{changeCamera:function(e,t){var n=this;switch(this.stopVideo(e),e){case 1:this.video[e].posX=this.canvasWidth/2;break;case 2:this.video[e].posY=this.canvasHeight/2;break;case 3:this.video[e].posX=this.canvasWidth/2,this.video[e].posY=this.canvasHeight/2;break}switch(t){case"none":break;case"audioWaveform":navigator.mediaDevices.getUserMedia({audio:{deviceId:this.audioId},video:!1}).then((function(t){n.video[e].value="audioWaveform",n.playAudioWaveform(e,t)})).catch((function(e){alert("ERROR: 音声の取得に失敗しました: "+e.message)}));break;default:navigator.mediaDevices.getUserMedia({audio:!1,video:{width:this.canvasWidth/2,height:this.canvasHeight/2,deviceId:t}}).then((function(i){n.video[e].value=t,n.playVideo(e,i)})).catch((function(e){alert("ERROR: Webカメラの起動に失敗しました: "+e.message)}))}},changeMic:function(e){this.audioId="none"===e?"":e,console.log("this.audioId: "+this.audioId)},playVideo:function(e,t){var n=this;this.video[e].element.srcObject=t,this.video[e].element.onloadedmetadata=function(){n.video[e].element.play(),n.video[e].timer=setInterval((function(){n.context&&n.context.drawImage(n.video[e].element,n.video[e].posX,n.video[e].posY,n.canvasWidth/2,n.canvasHeight/2)}),1e3/n.fps)}},playAudioWaveform:function(e,t){var n=this,i=new AudioContext,a=i.createMediaStreamSource(t),c=i.createAnalyser();c.fftSize=128,a.connect(c),this.video[e].timer_audio=setInterval((function(){var t=n.canvasWidth/2/c.fftSize,i=new Uint8Array(c.fftSize);c.getByteTimeDomainData(i),n.context.fillStyle="#fefefe",n.context.fillRect(n.video[e].posX,n.video[e].posY,n.canvasWidth/2,n.canvasHeight/2);for(var a=0;a<c.fftSize;++a){var o=i[a],r=o/255,s=n.canvasHeight/2*r,d=n.canvasHeight/2-s;n.context.fillStyle="lightgreen",n.context.fillRect(n.video[e].posX+a*t,n.video[e].posY+d,t,2)}}),1e3/this.fps)},stopVideo:function(e){switch(this.video[e].value){case"none":break;case"audioWaveform":clearInterval(this.video[e].timer_audio);break;default:null!==this.video[e].element.srcObject&&(this.video[e].element.pause(),this.video[e].element.srcObject.getTracks().forEach((function(e){e.stop()})),this.video[e].element.srcObject=null),clearInterval(this.video[e].timer)}this.video[e].value="none",this.context.clearRect(this.video[e].posX,this.video[e].posY,this.canvasWidth/2,this.canvasHeight/2)},clickRecordingBtn:function(){var e=this;if(this.isRecording){if("inactive"==this.mediaRecorder.state)return;this.mediaRecorder.stop(),this.isRecording=!1,this.mediaRecorder.addEventListener("dataavailable",(function(t){var n=document.createElement("a"),i=new Blob([t.data],{type:t.data.type}),a=window.URL.createObjectURL(i);e.mimetype.match(/webm/)?n.download=e.getNow()+".webm":e.mimetype.match(/mpeg/)&&(n.download=e.getNow()+".mp4"),n.href=a,n.click(),clearInterval(e.timer_recording),e.record_status=e.mediaRecorder.state,e.time_recording_sec=0,e.record_text="Start recording"}))}else{if(!confirm("録画を開始します"))return;var t=this.canvas.captureStream();navigator.mediaDevices.getUserMedia({video:!1,audio:{deviceId:this.audioId}}).then((function(n){var i=new MediaStream([t.getTracks()[0],n.getAudioTracks()[0]]);e.mediaRecorder=new MediaRecorder(i,{mimeType:e.mimetype}),"recording"!=e.mediaRecorder.state&&(e.record_status=e.mediaRecorder.state,e.timer_recording=setInterval((function(){e.record_status=e.mediaRecorder.state,e.record_time=e.transSecToTime(e.time_recording_sec),e.time_recording_sec++}),1e3),e.mediaRecorder.start(),e.isRecording=!0,e.record_text="Stop recording")}))}},getNow:function(){var e=new Date,t=e.getFullYear(),n=("00"+e.getMonth()).slice(-2),i=("00"+e.getDate()).slice(-2),a=("00"+e.getHours()).slice(-2),c=("00"+e.getMinutes()).slice(-2),o=("00"+e.getSeconds()).slice(-2);return t+n+i+"_"+a+c+o},transSecToTime:function(e){var t=("00"+parseInt(e/3600)).slice(-2),n=("00"+parseInt(e/60)).slice(-2),i=("00"+(e-(3600*t+60*n))).slice(-2);return t+":"+n+":"+i}},watch:{canvasHeight:function(){this.canvasWidth=this.canvasHeight/9*16,this.selectWidth=this.canvasWidth/2+"px",this.canvas_height=this.canvasHeight+"px",this.video[1].posX=this.canvasWidth/2,this.video[2].posY=this.canvasHeight/2,this.video[3].posX=this.canvasWidth/2,this.video[3].posY=this.canvasHeight/2},frameRate:function(){console.log(this.frameRate),this.fps=this.frameRate},mimetype:function(){}},data:function(){return{canvasWidth:640,selectWidth:"320px",canvas_height:"360px",video:[{value:"none",element:null,posX:0,posY:0,timer:null,timer_audio:null},{value:"none",element:null,posX:this.canvasWidth/2,posY:0,timer:null,timer_audio:null},{value:"none",element:null,posX:0,posY:0,timer:null,timer_audio:null},{value:"none",element:null,posX:this.canvasWidth/2,posY:this.canvasHeight/2,timer:null,timer_audio:null}],audioId:"",fps:30,isRecording:!1,record_text:"Start recording",record_status:"inactive",record_time:"00:00:00",time_recording_sec:0,timer_recording:null}}},Y=function(){Object(i["q"])((function(e){return{"2617c7af":e.selectWidth,"70139a33":e.canvas_height}}))},A=T.setup;T.setup=A?function(e,t){return Y(),A(e,t)}:Y;var D=T;n("b27b");const U=S()(D,[["render",O],["__scopeId","data-v-1f02f1be"]]);var z=U,X=function(e){return Object(i["m"])("data-v-02bd058a"),e=e(),Object(i["l"])(),e},V={class:"background-shadow"},N={class:"popup"},P={class:"wrapper"},$=X((function(){return Object(i["f"])("h2",null,"Settings",-1)})),B={class:"wrapper"},E={class:"setting-elem"},F=X((function(){return Object(i["f"])("h3",null,"Size : ",-1)})),L=["value"],q={class:"setting-elem"},J=X((function(){return Object(i["f"])("h3",null,"Frame rate (canvas) : ",-1)})),G=["value"],K={class:"setting-elem"},Q=X((function(){return Object(i["f"])("h3",null,"Mimetype : ",-1)})),Z=["value","disabled"];function ee(e,t,n,a,c,o){var r=Object(i["o"])("fa");return Object(i["k"])(),Object(i["e"])("div",V,[Object(i["f"])("div",N,[Object(i["f"])("header",P,[$,Object(i["f"])("p",{id:"btn-icon-times",class:"btn-icon",onClick:t[0]||(t[0]=function(){return o.closeSettings&&o.closeSettings.apply(o,arguments)})},[Object(i["h"])(r,{icon:"times"})])]),Object(i["f"])("main",B,[Object(i["f"])("section",E,[F,Object(i["v"])(Object(i["f"])("select",{id:"select-canvasSize","onUpdate:modelValue":t[1]||(t[1]=function(e){return o.select_canvasHeight=e})},[(Object(i["k"])(!0),Object(i["e"])(i["a"],null,Object(i["n"])(c.size_options,(function(e){return Object(i["k"])(),Object(i["e"])("option",{value:e.height,key:e.width},Object(i["p"])(e.width+" * "+e.height),9,L)})),128))],512),[[i["r"],o.select_canvasHeight]])]),Object(i["f"])("section",q,[J,Object(i["v"])(Object(i["f"])("select",{id:"select-frameRate","onUpdate:modelValue":t[2]||(t[2]=function(e){return o.select_frameRate=e})},[(Object(i["k"])(!0),Object(i["e"])(i["a"],null,Object(i["n"])(c.frame_options,(function(e){return Object(i["k"])(),Object(i["e"])("option",{value:e,key:e},Object(i["p"])(e),9,G)})),128))],512),[[i["r"],o.select_frameRate]])]),Object(i["f"])("section",K,[Q,Object(i["v"])(Object(i["f"])("select",{id:"select-mimetype","onUpdate:modelValue":t[3]||(t[3]=function(e){return o.select_mimetype=e})},[(Object(i["k"])(!0),Object(i["e"])(i["a"],null,Object(i["n"])(c.mimetype_options,(function(e){return Object(i["k"])(),Object(i["e"])("option",{value:e.name,key:e.name,disabled:!e.isSupported},Object(i["p"])(e.name),9,Z)})),128))],512),[[i["r"],o.select_mimetype]])])])])])}var te={name:"App",components:{},methods:{closeSettings:function(){this.$emit("close-settings")}},props:{canvasHeight:Number,frameRate:Number,mimetype:String},mounted:function(){var e=this;this.mimetype_options.map((function(t,n){MediaRecorder.isTypeSupported(t.name)&&(e.mimetype_options[n].isSupported=!0,e.select_mimetype=t.name)}))},computed:{select_canvasHeight:{get:function(){return this.canvasHeight},set:function(e){this.$emit("change-canvas-size",e)}},select_frameRate:{get:function(){return this.frameRate},set:function(e){this.$emit("change-frame-rate",e)}},select_mimetype:{get:function(){return this.mimetype},set:function(e){this.$emit("change-mimetype",e)}}},data:function(){return{size_options:[{width:640,height:360},{width:1280,height:720},{width:1920,height:1080}],frame_options:[15,30,60],mimetype_options:[{name:"video/webm",isSupported:!1},{name:"video/webm;codecs=vp8",isSupported:!1},{name:"video/webm;codecs=vp9",isSupported:!1},{name:"video/webm;codecs=daala",isSupported:!1},{name:"video/webm;codecs=h264",isSupported:!1},{name:"video/mpeg",isSupported:!1}]}}};n("bbbe"),n("bc12");const ne=S()(te,[["render",ee],["__scopeId","data-v-02bd058a"]]);var ie=ne,ae=function(e){return Object(i["m"])("data-v-55034a03"),e=e(),Object(i["l"])(),e},ce={class:"background-shadow"},oe={class:"popup"},re={class:"wrapper"},se={class:"container"},de=ae((function(){return Object(i["f"])("h2",null,"How to use",-1)}));function ue(e,t,n,a,c,o){var r=Object(i["o"])("fa");return Object(i["k"])(),Object(i["e"])("div",ce,[Object(i["f"])("div",oe,[Object(i["f"])("header",re,[Object(i["f"])("div",se,[de,Object(i["f"])("p",{id:"btn-icon-times",class:"btn-icon",onClick:t[0]||(t[0]=function(){return o.closeInformation&&o.closeInformation.apply(o,arguments)})},[Object(i["h"])(r,{icon:"times"})])])])])])}var le={name:"Information",components:{},methods:{closeInformation:function(){this.$emit("close-information")}},data:function(){return{}}};n("4b4f");const me=S()(le,[["render",ue],["__scopeId","data-v-55034a03"]]);var fe=me,he={name:"App",components:{Recorder:z,Settings:ie,Information:fe},mounted:function(){this.year=(new Date).getFullYear()},methods:{setCanvasSize:function(e){this.canvasHeight=e},setFrameRate:function(e){this.frameRate=e},setMimetype:function(e){this.mimetype=e},openSettings:function(){this.showSettings=!0},closeSettings:function(){this.showSettings=!1},openInformation:function(){this.showInformation=!0},closeInformation:function(){this.showInformation=!1}},data:function(){return{canvasHeight:360,frameRate:30,mimetype:"video/webm;codecs=vp8",showSettings:!1,showInformation:!1,year:2022}}};n("3629"),n("ed47");const pe=S()(he,[["render",h],["__scopeId","data-v-00a216dd"]]);var ve=pe,be=(n("f5df1"),n("ecee")),ge=n("c074"),Oe=n("ad3d");be["c"].add(ge["a"]),Object(i["d"])(ve).component("fa",Oe["a"]).mount("#app")},"7b43":function(e,t,n){},"9b3b":function(e,t,n){},b27b:function(e,t,n){"use strict";n("3bc4")},bbbe:function(e,t,n){"use strict";n("9b3b")},bc12:function(e,t,n){"use strict";n("7b43")},ecb8:function(e,t,n){},ed47:function(e,t,n){"use strict";n("5411")}});
//# sourceMappingURL=app.c87fa7bd.js.map